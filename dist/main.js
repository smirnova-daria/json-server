(()=>{"use strict";const t=t=>{const e=document.getElementById("table-body");e.innerHTML="",t.forEach((t=>{e.insertAdjacentHTML("beforeend",`\n\t\t\t<tr data-key="${t.id}">\n\t\t\t\t<th scope="row">${t.id}</th>\n\t\t\t\t<td>${t.name}</td>\n\t\t\t\t<td>${t.email}</td>\n\t\t\t\t<td>${t.children?"Есть":"Нет"}</td>\n\t\t\t\t<td>\n\t\t\t\t\t<div class="form-check form-switch">\n\t\t\t\t\t\t<input class="form-check-input" type="checkbox" role="switch"\n\t\t\t\t\t\t\tid="form-children" ${t.permissions?"checked":""}>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<div class="btn-group btn-group-sm" role="group" aria-label="Basic example">\n\t\t\t\t\t\t<button type="button" class="btn btn-warning btn-edit">\n\t\t\t\t\t\t\t<i class="bi-pencil-square"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="btn btn-danger btn-remove">\n\t\t\t\t\t\t\t<i class="bi-person-x"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t`)}))},e=()=>{let t=document.querySelector(".error-block");t||(document.querySelector("table").insertAdjacentHTML("afterend",'<p class="error-block" style="color:red; text-align:center">Произошла ошибка, данных нет!</p>'),t=document.querySelector(".error-block")),setTimeout((()=>{t.remove()}),5e3)};window.userService=new class{async getData(t){return fetch(t).then((t=>t.json()))}async sendData(t){return fetch(t.url,{method:t.method,headers:{"Content-Type":"application/json"},body:t.body}).then((t=>t.json()))}getUsers(){return this.getData("http://localhost:4545/users")}addUser(t){return this.sendData({url:"http://localhost:4545/users",method:"POST",body:JSON.stringify(t)})}removeUser(t){return this.sendData({url:`http://localhost:4545/users/${t}`,method:"DELETE"})}changeUser(t,e){return this.sendData({url:`http://localhost:4545/users/${t}`,method:"PATCH",body:JSON.stringify(e)})}getUser(t){return this.getData(`http://localhost:4545/users/${t}`)}editUser(t,e){return this.sendData({url:`http://localhost:4545/users/${t}`,method:"PUT",body:JSON.stringify(e)})}filterUsers(t){return this.getData(`http://localhost:4545/users?${t}=true`)}getSortUsers(t){return this.getData(`http://localhost:4545/users?_sort=${t.name}&_order=${t.value}`)}getSearchUser(t){return this.getData(`http://localhost:4545/users?name_like=${t}`)}},userService.getUsers().then((e=>{t(e)})).catch((()=>{e()})),(()=>{const r=document.querySelector("form"),s=r.querySelector("#form-name"),n=r.querySelector("#form-email"),c=r.querySelector("#form-children");r.addEventListener("submit",(o=>{if(o.preventDefault(),!r.dataset.method){const o={name:s.value,email:n.value,children:c.checked,permissions:!1};userService.addUser(o).then((()=>{userService.getUsers().then((e=>{t(e),r.reset()})).catch((()=>{e()}))})).catch((()=>{e()}))}}))})(),document.getElementById("table-body").addEventListener("click",(r=>{if(r.target.closest(".btn-remove")){const s=r.target.closest("tr").dataset.key;userService.removeUser(s).then((r=>{userService.getUsers().then((e=>{t(e)})).catch((()=>{e()}))})).catch((()=>{e()}))}})),document.getElementById("table-body").addEventListener("click",(r=>{if(r.target.closest("input[type=checkbox]")){const s=r.target.closest("tr"),n=s.querySelector("input[type=checkbox]"),c=s.dataset.key;userService.changeUser(c,{permissions:n.checked}).then((r=>{userService.getUsers().then((e=>{t(e)})).catch((()=>{e()}))})).catch((()=>{e()}))}})),(()=>{const r=document.getElementById("table-body"),s=document.querySelector("form"),n=s.querySelector("#form-name"),c=s.querySelector("#form-email"),o=s.querySelector("#form-children");r.addEventListener("click",(t=>{if(t.target.closest(".btn-edit")){const r=t.target.closest("tr").dataset.key;userService.getUser(r).then((t=>{n.value=t.name,c.value=t.email,o.checked=t.children,s.dataset.method=r})).catch((()=>{e()}))}})),s.addEventListener("submit",(r=>{if(r.preventDefault(),s.dataset.method){const r=s.dataset.method,a={name:n.value,email:c.value,children:o.checked,permissions:!1};userService.editUser(r,a).then((()=>{userService.getUsers().then((e=>{t(e),s.reset(),s.removeAttribute("data-method")})).catch((()=>{e()}))})).catch((()=>{e()}))}}))})(),(()=>{const r=document.getElementById("btn-isChildren"),s=document.getElementById("btn-isPermissions"),n=document.getElementById("btn-isAll");r.addEventListener("click",(()=>{userService.filterUsers("children").then((e=>{t(e)})).catch((()=>{e()}))})),s.addEventListener("click",(()=>{userService.filterUsers("permissions").then((e=>{t(e)})).catch((()=>{e()}))})),n.addEventListener("click",(()=>{userService.getUsers().then((e=>{t(e)})).catch((()=>{e()}))}))})(),(()=>{const r=document.getElementById("sort-is-children");r.style.cursor="pointer";let s=!1;r.addEventListener("click",(r=>{userService.getSortUsers({name:"children",value:s?"asc":"desc"}).then((e=>{t(e)})).catch((()=>{e()})),s=!s}))})(),(()=>{const r=document.getElementById("search-input"),s=((t,e=300)=>{let r;return(...s)=>{clearTimeout(r),r=setTimeout((()=>{t.apply(void 0,s)}),e)}})((()=>{userService.getSearchUser(r.value).then((e=>{t(e)})).catch((()=>{e()}))}),500);r.addEventListener("input",s)})()})();